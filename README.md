# Configuration Comparator

这是一个用于比较生产环境服务器配置文件与本地 GitLab 配置文件的工具。

## 功能特性

- **多服务器支持**：支持配置多台生产环境服务器，按业务系统进行分组管理。
- **SSH 集成**：通过 SSH 自动获取服务器上的配置文件，支持密码加密存储与解密连接。
- **GitLab 集成**：自动获取 GitLab 仓库中的对应配置文件。
- **配置对比**：
  - **单文件对比**：展示配置文件内容的具体差异（Diff）。
  - **目录对比**：支持配置两台服务器的目录对，自动比对目录下所有文件的差异。
  - **批量操作**：支持对多个配置项或目录对进行批量比对。
- **定时任务**：
  - 支持创建 cron 风格的定时任务。
  - 自动在指定时间执行配置比对。
  - 记录每次执行的状态和结果。
- **历史记录**：将对比结果和配置快照存储在 MySQL 数据库中，支持查看历史变更。
- **权限管理**：基于用户的权限控制，普通用户只能访问授权的业务系统。

## 版本历史

### v1.2.0 (2026-01-08)
- **新增目录比对功能**：
  - 支持配置源服务器/目录与目标服务器/目录的比对关系。
  - 实现目录内文件的自动发现与差异比对。
  - 提供目录比对结果的聚合展示视图。
  - 支持批量执行目录比对任务。
- **界面优化**：
  - 优化列表页操作按钮布局。
  - 增加批量操作入口。

### v1.1.0 (2026-01-08)
- **新增定时任务功能**：
  - 集成 APScheduler 实现后台定时任务。
  - 支持通过 Web 界面管理定时任务（新增、编辑、暂停、删除）。
  - 自动执行比对并记录历史结果。
- **安全增强**：
  - 实现服务器密码的 AES 加密存储。
  - 优化 SSH 连接时的密码解密流程。
- **体验优化**：
  - 修复登录页验证码加载问题。
  - 优化配置列表页的宽屏适配与表单布局。
  - 修复 DiffResult 记录时区问题（统一为东八区）。
  - 实现离线环境下的静态资源本地化（去除 CDN 依赖）。

### v1.0.0 (Initial Release)
- 基础功能发布：
  - 用户认证与权限管理。
  - 服务器与业务系统管理。
  - 配置文件映射管理。
  - 基于文件的手动比对与 Diff 展示。
  - 基础的历史记录查看。

## 技术栈

- **后端**：Python (Flask)
- **数据库**：MySQL (SQLAlchemy)
- **任务调度**：Flask-APScheduler
- **前端**：HTML/Bootstrap 5 (Jinja2)
- **工具库**：
  - `paramiko`: 用于 SSH 连接
  - `python-gitlab`: 用于 GitLab API 操作
  - `cryptography`: 用于敏感数据加密
  - `SQLAlchemy`: ORM
  - `PyMySQL`: MySQL 驱动

## 快速开始

1. 安装依赖：
   ```bash
   pip install -r requirements.txt
   ```

2. 配置数据库和环境信息（参考 `config.ini`）。

3. 初始化数据库：
   ```bash
   flask db upgrade
   ```

4. 运行应用：
   ```bash
   python run.py
   ```

## 注意事项

1. 首次运行时，需要执行create_admin.py创建admin用户。

2. 需要手动添加业务系统、服务器和用户，以及配置文件映射。

3. 每次启动时会自动更新hosts.xlsx中服务器的用户名和密码。"# compareConfig" 
